function getParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function getSlug(){var e=location.pathname;"/"===e.substr(-1)&&(e=e.substr(0,e.length-1));var t=e.split("/");return t[t.length-1]}function formatDate(e){var t=("0"+e.getDate()).slice(-2),n=("0"+(e.getMonth()+1)).slice(-2),o=e.getFullYear(),i=("0"+e.getHours()).slice(-2),a=("0"+e.getMinutes()).slice(-2);return t+"."+n+"."+o+" в&nbsp;"+i+":"+a}function extractDomain(e){var t;return t=e.indexOf("://")>-1?e.split("/")[2]:e.split("/")[0],t.split(":")[0]}function loadFeeds(){$("#feeds__list").html(""),$.ajax({url:APIPath+"/feeds",type:"GET",dataType:"json"}).done(function(e){for(var t,n,o,i=new Date,a=0;a<e.length;a++)i.setTime(Date.parse(e[a].updated)),o=formatDate(i),t=$("<tr/>").data("id",e[a].id),$("<td/>",{"class":"feeds__urls",text:e[a].feedlink}).attr("title",e[a].feedlink).appendTo(t),$("<td/>",{"class":"feeds__update",html:o}).appendTo(t),n=$('<td class="feeds__del"><a href="#" class="link">Удалить</a></td>'),n.appendTo(t),n.find(".link").click(function(e){e.preventDefault(),delFeed($(this).closest("tr"))}),$("#feeds__list").append(t)}).fail(function(e){console.log("error while loading feeds"),console.log(e)})}function delFeed(e){var t=e.data("id");$.ajax({url:APIPath+"/feeds/"+t,type:"DELETE",headers:authHeaders}).done(function(){e.remove()}).fail(function(e){console.log("error while deleting the feed"),console.log(e)})}function toggleArticle(e){var t=e.siblings(".news__full"),n=$(".news__full-loader",t);$("body")[0];if(t.is(":visible"))t.hide();else{var o=$(".news__full:visible"),i=o.siblings(".news__light");if(o.length){if(t.offset().top>o.offset().top){var a=o.outerHeight(!0),s=$(document).scrollTop()-a;$(document).scrollTop(s),o.hide()}else o.hide();toggleArticleLink(i)}if(t.show(),n.is(":visible")){var r=t.closest(".news__item").data("id");$.ajax({url:APIPath+"/news/id/"+r,type:"GET",dataType:"json",async:!0}).done(function(e){e.content.length?n.after(e.content).hide():n.text("Увы, но у этой новости нет подробного текста")}).fail(function(e){n.text("Ошибка. Не получилось загрузить новость")})}}toggleArticleLink(e)}function toggleArticleLink(e){e.text(function(e,t){return"Подробнее"==t?"Скрыть":"Подробнее"})}function moveArticle(e){var t=$("#news__list .news__item"),n=t.length,o=e.data("pos"),i=e.index(),a=n-o-i-1;$.ajax({url:APIPath+"/news/move/"+o+"/"+a,type:"PUT",headers:authHeaders}).done(function(){resetPositions()}).fail(function(e){console.log("error while moving news"),console.log(e)})}function togeekArticle(e){var t=e.closest(".news__item");$.ajax({url:APIPath+"/news/geek/"+t.data("id"),type:"PUT",headers:authHeaders}).done(function(){t.data("geek",!0).addClass("news__item_geek"),e.removeClass("news__button_togeek").addClass("news__button_ingeek").off().click(function(e){e.preventDefault(),nogeekArticle($(this))})}).fail(function(e){console.log("error while geeking news"),console.log(e)})}function nogeekArticle(e){var t=e.closest(".news__item");$.ajax({url:APIPath+"/news/nogeek/"+t.data("id"),type:"PUT",headers:authHeaders}).done(function(){t.data("geek",!1).removeClass("news__item_geek"),e.removeClass("news__button_ingeek").addClass("news__button_togeek").off().click(function(e){e.preventDefault(),togeekArticle($(this))})}).fail(function(e){console.log("error while nogeeking news"),console.log(e)})}function restoreArticle(e){var t=e.closest(".news__item");$.ajax({url:APIPath+"/news/undelete/"+t.data("id"),type:"PUT",headers:authHeaders}).done(function(){t.remove()}).fail(function(e){console.log("error while deleting news"),console.log(e)})}function delArticle(e){var t=e.closest(".news__item");$.ajax({url:APIPath+"/news/"+t.data("id"),type:"DELETE",headers:authHeaders}).done(function(){t.remove(),resetPositions()}).fail(function(e){console.log("error while deleting news"),console.log(e)})}function archiveArticle(e){var t=e.closest(".news__item");$.ajax({url:APIPath+"/news/archive/"+t.data("id"),type:"PUT",headers:authHeaders}).done(function(){t.remove(),resetPositions()}).fail(function(e){console.log("error while archiving news"),console.log(e)})}function resetPositions(){var e,t=$("#news__list .news__item");$.ajax({url:APIPath+"/news/positions",type:"GET",dataType:"json",cache:!1,async:!0}).done(function(n){for(var o=0;o<t.length;o++)$item=t.eq(o),e=$item.data("id"),n[e]&&$item.data("pos",n[e])}).fail(function(e){console.log("error while gettins positions"),console.log(e)})}function sortJSON(e,t){switch(t){case"comments":e.sort(function(e,t){return t.comments-e.comments});break;case"likes":e.sort(function(e,t){return t.likes-e.likes});break;case"recent":e.sort(function(e,t){return e.ats>t.ats?-1:e.ats<t.ats?1:0});break;case"priority":e.sort(function(e,t){return t.position-e.position})}}function filterJSON(e,t){for(var n=new Date,o=864e5,i=7*o,a=30*o,s=e.length-1;s>=0;s--)if(e[s].enable=!0,!t.geek||e[s].geek){if(t.common&&e[s].geek)e[s].enable=!1;else if(t.recent){var r=Date.parse(e[s].ats);if(t.geek&&e[s].geek){if((n-r)/(2*a+i)>1){e[s].enable=!1;continue}}else if((n-r)/(21*o)>1){e[s].enable=!1;continue}}}else e[s].enable=!1}function disableNewsSortable(){$(".news").addClass("news_disabled-sort"),$(".news__handler").hide()}function enableNewsSortable(){$(".news").removeClass("news_disabled-sort"),$(".news__handler").show()}function notify(e,t,n){$(".notify").remove();var o=$("<div/>",{"class":"notify",text:e});o.appendTo("body").slideDown("500").click(function(e){$(this).slideUp(500,function(){o.remove()}),t&&t()}),n&&setTimeout(function(){o.slideUp(500,function(){o.remove()}),t&&t()},n)}function scrollToEl(e){$("html, body").animate({scrollTop:e.offset().top},700)}var APIPath="http://master.radio-t.com:8780/api/v1",disqusID="radiotnewstest",login=localStorage.getItem("login"),password=localStorage.getItem("password"),sorting=localStorage.getItem("sorting"),authHeaders={Authorization:"Basic "+btoa(login+":"+password)},isMobile=/Android|iPhone|iPad|iPod|IEMobile|Windows Phone|Opera Mini/i.test(navigator.userAgent),isAdmin=login&&password,sortableList;$(function(){if($("#add-news").length){$("#add-news").submit(function(e){var t=$(this);return $.ajax({url:APIPath+"/news",type:"POST",async:!0,data:'{ "link": "'+decodeURIComponent($("#add__url").val())+'" }',headers:authHeaders}).done(function(){t.trigger("reset"),notify("Новость добавлена",null,1500)}).fail(function(e){notify("Ошибка при добавлении новости."),console.log("error while adding news"),console.log(e)}),!1});var e=getParameterByName("url");e.length&&($("#add__url").val(decodeURIComponent(e)),$("#add-news").submit())}$("#add__bookmark").length&&$("#add__bookmark").attr("href",function(){var e=function(){function e(e){a.color="#d00",i.textContent=e}function t(){n.setTimeout(function(){a.height="0",n.setTimeout(function(){i.parentNode.removeChild(i)},300)},500)}var n=window,o=document,i=o.createElement("div"),a=i.style;a.transition="all 200ms",a.position="fixed",a.left="0",a.right="0",a.top="0",a.zIndex=16777271,a.height="0",a.width="100%",a.overflow="hidden",a.background="#fff",a.borderBottom="1px solid #bdbdbd",a.boxShadow="0 0 30px #828282",a.color="#232323",a.fontSize="30px",a.fontWeight="700",a.fontFamily='"PT Serif", Georgia, serif',a.lineHeight="67px",a.textAlign="center",i.textContent="Сохраняю..",o.body.appendChild(i),n.setTimeout(function(){a.height="70px"},100),n.setTimeout(function(){var n=new XMLHttpRequest;n.open("POST","#LOCATION#/news",!1,"#LOGIN#","#PASSWORD#"),n.setRequestHeader("Authorization","Basic "+btoa("#LOGIN#:#PASSWORD#"));try{n.send('{ "link": "'+decodeURIComponent(location.href)+'" }'),4===n.readyState?200!==n.status?(e("Не смог сохранить"),t()):(a.color="#090",i.textContent="Сохранил",t()):(e("Не смог достучаться до сервера"),t())}catch(o){e("Не смог сохранить"),t()}},500)},t=e.toString().replace(/#LOCATION#/g,0==APIPath.indexOf("http")?APIPath:location.protocol+"//"+location.host+APIPath).replace(/#LOGIN#/g,login).replace(/#PASSWORD#/g,password);return"javascript:("+encodeURIComponent(t)+")();"})}),$(function(){$("#feeds__list").length&&(loadFeeds(),$("#feeds__add-form").submit(function(e){var t=$(this);return $.ajax({url:APIPath+"/feeds",type:"POST",async:!0,data:'{ "feedlink": "'+$("#feeds__add").val()+'" }',headers:authHeaders}).done(function(){loadFeeds(),t.trigger("reset")}).fail(function(e){console.log("error while adding feed"),console.log(e)}),!1}))}),$(function(){$(".filter__item_parent").click(function(e){var t=$(this),n=$(".filter__dropdown",t);e.preventDefault(),n.toggleClass("filter__dropdown_visible"),$("body").click(function(e){t.is(e.target)||0!==t.has(e.target).length||n.removeClass("filter__dropdown_visible")})})}),$(function(){isAdmin&&$("#start").show().click(function(e){e.preventDefault(),$.ajax({url:APIPath+"/show/start",type:"PUT",headers:authHeaders}).done(function(e){$("html, body").scrollTop(0),notify("Поехали!",null,1500)}).fail(function(e){console.log("error while starting show"),console.log(e)})})}),$(function(){var e=$('.menu__item a[href="'+location.pathname+'"]');e.parent().html(e.text()),isAdmin&&($(".menu__item_admin").css("display","inline-block"),$(".menu__item_user").hide())}),$(function(){var e=$("#login");e.length&&e.submit(function(t){$(".login__error",e).hide();var n=$(this).find("input[name=login]").val(),o=$(this).find("input[name=password]").val();if(n&&o){var i=new XMLHttpRequest;i.open("PUT",APIPath+"/news/reload",!0,n,o),i.setRequestHeader("Authorization","Basic "+btoa(n+":"+o)),i.onreadystatechange=function(e){if(4===i.readyState)if(200!==i.status)$("#login .login__error").show();else{localStorage.setItem("login",n),localStorage.setItem("password",o);var t=getParameterByName("back");t?location.href=t:location.href="/admin/"}},i.send()}return!1})}),$(function(){$("#update-feeds").click(function(e){e.preventDefault(),$.ajax({url:APIPath+"/news/reload",type:"PUT",headers:authHeaders}).done(function(){location.reload()}).fail(function(e){console.log("error while updating feeds"),console.log(e)})}),$("#logout").click(function(e){e.preventDefault();var t=new XMLHttpRequest;t.open("PUT",APIPath+"/news/reload",!1,"harry","colloportus");try{t.send(),4===t.readyState&&(localStorage.removeItem("login"),localStorage.removeItem("password"),location.href="/login/")}catch(n){localStorage.removeItem("login"),localStorage.removeItem("password"),location.href="/login/"}})}),$(function(){function e(e){sorting&&"priority"!=sorting&&sortJSON(e,sorting);for(var t,n=0;n<e.length;n++)g.setTime(Date.parse(e[n].ts)),t=$("<a/>",{href:e[n].link,"class":"link",title:e[n].title,text:extractDomain(e[n].link),target:"_blank"}),1==g.getFullYear()&&g.setTime(Date.parse(e[n].ats)),c=e[n].author?e[n].author+" ("+t.prop("outerHTML")+"), "+formatDate(g):t.prop("outerHTML")+", "+formatDate(g),h.find(".news__title").attr("href","/post/"+e[n].slug).text(e[n].title).end().find(".news__info").prepend(c).end().find(".news__desc").html(e[n].snippet).end().find(".news__info-stat").attr("href","/post/"+e[n].slug+"#to-comments").end().find(".news__comments").append(e[n].comments).end().find(".news__light").click(function(e){e.preventDefault(),toggleArticle($(this))}).show().end().find(".news__likes").append(e[n].likes).end().attr("data-id",e[n].id).attr("id","").data("comments",e[n].comments).data("likes",e[n].likes).data("ats",e[n].ats).data("pos",e[n].position).data("geek",e[n].geek),e[n].pic&&h.find(".news__image-hidden").attr("src",e[n].pic).load(function(){$(this).siblings(".news__image").css("background-image","url("+$(this).attr("src")+")").end().remove()}),e[n].active&&(h.addClass("news__item_current").attr("id","current"),setTimeout(function(){$(document).trigger("current-updated")},300)),h.appendTo(u),(e[n].active||e[n].enable||"undefined"==typeof e[n].enable)&&h.show(),isAdmin&&0==$(".news_archive").length?e[n].geek&&h.find(".news__button_togeek").removeClass("news__button_togeek").addClass("news__button_ingeek").end().addClass("news__item_geek"):e[n].geek&&h.addClass("news__item_geek-light"),h=f.clone(!0,!0);$(document).trigger("news-loaded")}function t(){$.ajax({url:APIPath+"/news",type:"GET",dataType:"json",cache:!1,async:!0,beforeSend:function(){d.text("Загружаю..").show()}}).done(function(t){$(document).on("news-loaded",function(){d.hide(),"priority"!=activeSorting&&disableNewsSortable(),(p.geek||p.recent||p.common)&&disableNewsSortable(),isAdmin&&(isMobile||(sortableList=new Sortable($("#news__list")[0],{animation:150,draggable:".news__item",ghostClass:"news__item_sortable",handle:".news__handler",scrollSensitivity:70,onUpdate:function(e){moveArticle($(e.item))}})),$(".news__button_current").click(function(e){e.preventDefault();var t=$(this).closest(".news__item");$.ajax({url:APIPath+"/news/active/"+t.data("id"),type:"PUT",headers:authHeaders,async:!1}).done(function(){t.addClass("news__item_current").siblings(".news__item").removeClass("news__item_current")}).fail(function(e){console.log("error while activating news"),console.log(e)})}),$(".news__button_first").click(function(e){e.preventDefault();var t=$(this).closest(".news__item");t.prependTo("#news__list"),moveArticle(t)}),$(".news__button_up").click(function(e){e.preventDefault();var t=$(this).closest(".news__item");t.prev().before(t),moveArticle(t)}),$(".news__button_down").click(function(e){e.preventDefault();var t=$(this).closest(".news__item");t.next().after(t),moveArticle(t)}),$(".news__button_togeek").click(function(e){e.preventDefault(),togeekArticle($(this))}),$(".news__button_ingeek").click(function(e){e.preventDefault(),nogeekArticle($(this))}),$(".news__button_del").click(function(e){e.preventDefault(),delArticle($(this))}),$(".news__button_archive").click(function(e){e.preventDefault(),archiveArticle($(this))})),$(document).trigger("fullpage-loaded")}),filterJSON(t,p),e(t)}).fail(function(e){d.text("Ошибка при загрузке, попробуйте обновить страницу").slideDown(),console.log(e)})}function n(){$.ajax({url:APIPath+"/news/del",type:"GET",dataType:"json",cache:!1,async:!0,beforeSend:function(){d.text("Загружаю..").show()}}).done(function(t){$(document).on("news-loaded",function(){d.hide(),$(".news__button_restore").click(function(e){e.preventDefault(),restoreArticle($(this))})}),e(t)}).fail(function(e){d.text("Ошибка при загрузке, попробуйте обновить страницу").slideDown(),console.log(e)})}function o(){$.ajax({url:APIPath+"/news/archive",type:"GET",dataType:"json",cache:!1,async:!0,beforeSend:function(){d.text("Загружаю..").show()}}).done(function(t){$(document).on("news-loaded",function(){d.hide(),isAdmin?$(".news__button_del").click(function(e){e.preventDefault(),delArticle($(this))}):$(".news__manage").remove()}),e(t)}).fail(function(e){d.text("Ошибка при загрузке, попробуйте обновить страницу").slideDown(),console.log(e)})}function i(){var e=295;$.ajax({url:APIPath+"/news/active/wait/"+e,type:"GET",dataType:"json",async:!0}).done(function(e){if("undefined"==typeof e)return void i();var n=$(".news__item[data-id="+e.id+"]");n.length?(n.hasClass("news__item_current")||($(".news__item_current").removeClass("news__item_current"),n.addClass("news__item_current"),s(),document.title="** Тема обновилась **",notify("Тема обновилась. Нажмите, чтобы перейти к ней.",function(){$("html, body").animate({scrollTop:$(".news__item_current").offset().top},700),document.title=_})),i()):(document.title="** Ошибка **",notify("Текущей темы нет в этом списке. Вероятно, он устарел. Нажмите, чтобы его обновить.",function(){$("#news__list").html(""),t(),$(document).one("current-updated",function(){$("html, body").animate({scrollTop:$(".news__item_current").offset().top},700)}),document.title=_}))}).fail(function(e){setTimeout(function(){i()},1e3)})}function a(e){var t=$("#news__list .news__item");switch(e){case"comments":t.sort(function(e,t){return $(t).data("comments")-$(e).data("comments")}).appendTo(u);break;case"likes":t.sort(function(e,t){return $(t).data("likes")-$(e).data("likes")}).appendTo(u);break;case"recent":t.sort(function(e,t){return $(e).data("ats")>$(t).data("ats")?-1:$(e).data("ats")<$(t).data("ats")?1:0}).appendTo(u);break;case"priority":t.sort(function(e,t){return $(t).data("pos")-$(e).data("pos")}).appendTo(u)}}function s(){for(var e=$("#news__list .news__item"),t=new Date,n=864e5,o=30*n,i=0;i<e.length;i++){var a=e.eq(i);if(!a.hasClass("news__item_current"))if(!p.geek||a.data("geek"))if(p.common&&a.data("geek"))a.hide();else{if(p.recent){var s=Date.parse(a.data("ats"));if(p.geek&&a.data("geek")){if((t-s)/(3*o)>1){a.hide();continue}}else if((t-s)/(21*n)>1){a.hide();continue}}a.show()}else a.hide()}}function r(){$("#news__sort").css("display",$("#news__sort").hasClass("news__sort")?"block":"inline-block").find(".sorter__link").click(function(e){e.preventDefault();var t=$(this).data("sort");$(this).hasClass("sorter__link_active")||(a(t),$("#news__sort .sorter__link_active").removeClass("sorter__link_active"),$(this).addClass("sorter__link_active"),"priority"==t?(localStorage.removeItem("sorting"),!isAdmin||p.geek||p.recent||p.common||enableNewsSortable()):(localStorage.setItem("sorting",t),isAdmin&&disableNewsSortable()))})}function l(){$("#news__filter").css("display","inline-block").find("[data-filter]").each(function(){var e=$(this).data("filter");for(var t in p)e==t&&p[t]&&($(this).closest(".filter__item").addClass("filter__item_active"),$(this).hasClass("filter__dropdown-link")&&$(this).closest(".filter__item").find(".filter__current").text($(this).text()))}).click(function(e){e.preventDefault();$(this).data("filter");$(this).hasClass("filter__dropdown-link")?($(this).closest(".filter__item").find(".filter__dropdown-link").each(function(e){0!=e&&(p[$(this).data("filter")]=!1)}),0==$(this).parent().index()?$(this).closest(".filter__item").removeClass("filter__item_active"):($(this).closest(".filter__item").addClass("filter__item_active"),p[$(this).data("filter")]=!0),$(this).closest(".filter__item").find(".filter__current").text($(this).text())):($(this).closest(".filter__item").toggleClass("filter__item_active"),p[$(this).data("filter")]^=1),localStorage.setItem("filters",JSON.stringify(p)),s(),p.geek||p.recent||p.common?disableNewsSortable():enableNewsSortable()})}var c,d=$("#news__top-status"),u=$("#news__list"),f=$("#news__skeleton"),h=f.clone(!0,!0),g=new Date,p=JSON.parse(localStorage.getItem("filters"))||{recent:!1,geek:!1,common:!1},_=document.title;$("#news__list").length&&(isMobile&&$(".news").addClass("news_mobile"),$(".news_deleted").length?n():$(".news_archive").length?(o(),$(document).on("news-loaded",function(){r()})):(t(),$(document).on("news-loaded",function(){var e=(new Date).getDay();(6==e||0==e||isAdmin)&&i(),r(),l()})),sorting?activeSorting=sorting:(activeSorting="priority",$(".news_archive").length&&(activeSorting="recent")),$('#news__sort .sorter__link[data-sort="'+activeSorting+'"]').addClass("sorter__link_active"))}),$(function(){function e(){$.ajax({url:APIPath+"/news/slug/"+i,type:"GET",dataType:"json",cache:!0,async:!0,beforeSend:function(){n.text("Загружаю..").show()}}).done(function(e){n.hide(),$(document).on("news-loaded",function(){var e=setInterval(function(){var t=$("#disqus_thread").height();t>250&&($("#menu__item_to-comments").css("display","inline-block").find(".link").click(function(e){e.preventDefault(),$("html,body").animate({scrollTop:$($(this).attr("href")).offset().top},500)}),"#to-comments"==location.hash&&($("#menu__item_to-comments .link").click(),history.pushState("",document.title,window.location.pathname)),clearInterval(e))},100)}),t(e),document.title=e.title,function(){var e=document,t=e.createElement("script");t.src="//"+disqusID+".disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()}).fail(function(e){n.text("Ошибка при загрузке, попробуйте обновить страницу").slideDown(),console.log(e)})}function t(e){var t,n=new Date;n.setTime(Date.parse(e.ts));var i=$("<a/>",{href:e.link,"class":"link",title:e.title,text:extractDomain(e.link),target:"_blank"});t=e.author?e.author+" ("+i.prop("outerHTML")+"), "+formatDate(n):i.prop("outerHTML")+", "+formatDate(n),o.find(".onenews__title").text(e.title).attr("href",e.link).attr("target","_blank").end().find(".onenews__info").append(t).end().find(".onenews__body").html(e.content),e.geek&&o.find(".onenews__geek").show(),$(document).trigger("news-loaded")}var n=$("#onenews__top-status"),o=$("#onenews"),i=getSlug();login&&password&&$("#menu__back-link").attr("href","/admin/"),$("#onenews").length&&("undefined"!=typeof i&&i.length>0?e():location.href="/")}),$(document).on("current-updated",function(){var e=$("#current"),t=$("#to-current");t.length&&e.length&&(t.css("display","inline-block"),"#current"==location.hash&&scrollToEl(e),t.click(function(t){t.preventDefault(),scrollToEl(e)}))}),!function(e){"use strict";"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=e():"undefined"!=typeof Package?Sortable=e():window.Sortable=e()}(function(){"use strict";function e(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be HTMLElement, and not "+{}.toString.call(e);this.el=e,this.options=t=m({},t),e[B]=this;var n={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(e.nodeName)?"li":">*",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",ignore:"a, img",filter:null,animation:0,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1};for(var o in n)!(o in t)&&(t[o]=n[o]);W(t);for(var a in this)"_"===a.charAt(0)&&(this[a]=this[a].bind(this));this.nativeDraggable=t.forceFallback?!1:M,i(e,"mousedown",this._onTapStart),i(e,"touchstart",this._onTapStart),this.nativeDraggable&&(i(e,"dragover",this),i(e,"dragenter",this)),q.push(this._onDragOver),t.store&&this.sort(t.store.get(this))}function t(e){$&&$.state!==e&&(r($,"display",e?"none":""),!e&&$.state&&k.insertBefore($,v),$.state=e)}function n(e,t,n){if(e){n=n||R,t=t.split(".");var o=t.shift().toUpperCase(),i=new RegExp("\\s("+t.join("|")+")(?=\\s)","g");do if(">*"===o&&e.parentNode===n||(""===o||e.nodeName.toUpperCase()==o)&&(!t.length||((" "+e.className+" ").match(i)||[]).length==t.length))return e;while(e!==n&&(e=e.parentNode))}return null}function o(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.preventDefault()}function i(e,t,n){e.addEventListener(t,n,!1)}function a(e,t,n){e.removeEventListener(t,n,!1)}function s(e,t,n){if(e)if(e.classList)e.classList[n?"add":"remove"](t);else{var o=(" "+e.className+" ").replace(H," ").replace(" "+t+" "," ");e.className=(o+(n?" "+t:"")).replace(H," ")}}function r(e,t,n){var o=e&&e.style;if(o){if(void 0===n)return R.defaultView&&R.defaultView.getComputedStyle?n=R.defaultView.getComputedStyle(e,""):e.currentStyle&&(n=e.currentStyle),void 0===t?n:n[t];t in o||(t="-webkit-"+t),o[t]=n+("string"==typeof n?"":"px")}}function l(e,t,n){if(e){var o=e.getElementsByTagName(t),i=0,a=o.length;if(n)for(;a>i;i++)n(o[i],i);return o}return[]}function c(e,t,n,o,i,a,s){var r=R.createEvent("Event"),l=(e||t[B]).options,c="on"+n.charAt(0).toUpperCase()+n.substr(1);r.initEvent(n,!0,!0),r.to=t,r.from=i||t,r.item=o||t,r.clone=$,r.oldIndex=a,r.newIndex=s,t.dispatchEvent(r),l[c]&&l[c].call(e,r)}function d(e,t,n,o,i,a){var s,r,l=e[B],c=l.options.onMove;return s=R.createEvent("Event"),s.initEvent("move",!0,!0),s.to=t,s.from=e,s.dragged=n,s.draggedRect=o,s.related=i||t,s.relatedRect=a||t.getBoundingClientRect(),e.dispatchEvent(s),c&&(r=c.call(l,s)),r}function u(e){e.draggable=!1}function f(){Y=!1}function h(e,t){var n=e.lastElementChild,o=n.getBoundingClientRect();return(t.clientY-(o.top+o.height)>5||t.clientX-(o.right+o.width)>5)&&n}function g(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,n=t.length,o=0;n--;)o+=t.charCodeAt(n);return o.toString(36)}function p(e){var t=0;if(!e||!e.parentNode)return-1;for(;e&&(e=e.previousElementSibling);)"TEMPLATE"!==e.nodeName.toUpperCase()&&t++;return t}function _(e,t){var n,o;return function(){void 0===n&&(n=arguments,o=this,setTimeout(function(){1===n.length?e.call(o,n[0]):e.apply(o,n),n=void 0},t))}}function m(e,t){if(e&&t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}var v,w,b,$,k,y,D,T,S,x,P,C,A,I,E,N,O,j={},H=/\s+/g,B="Sortable"+(new Date).getTime(),L=window,R=L.document,U=L.parseInt,M=!!("draggable"in R.createElement("div")),X=function(e){return e=R.createElement("x"),e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}(),Y=!1,G=Math.abs,q=([].slice,[]),F=_(function(e,t,n){if(n&&t.scroll){var o,i,a,s,r=t.scrollSensitivity,l=t.scrollSpeed,c=e.clientX,d=e.clientY,u=window.innerWidth,f=window.innerHeight;if(T!==n&&(D=t.scroll,T=n,D===!0)){D=n;do if(D.offsetWidth<D.scrollWidth||D.offsetHeight<D.scrollHeight)break;while(D=D.parentNode)}D&&(o=D,i=D.getBoundingClientRect(),a=(G(i.right-c)<=r)-(G(i.left-c)<=r),s=(G(i.bottom-d)<=r)-(G(i.top-d)<=r)),a||s||(a=(r>=u-c)-(r>=c),s=(r>=f-d)-(r>=d),(a||s)&&(o=L)),(j.vx!==a||j.vy!==s||j.el!==o)&&(j.el=o,j.vx=a,j.vy=s,clearInterval(j.pid),o&&(j.pid=setInterval(function(){o===L?L.scrollTo(L.pageXOffset+a*l,L.pageYOffset+s*l):(s&&(o.scrollTop+=s*l),a&&(o.scrollLeft+=a*l))},24)))}},30),W=function(e){var t=e.group;t&&"object"==typeof t||(t=e.group={name:t}),["pull","put"].forEach(function(e){e in t||(t[e]=!0)}),e.groups=" "+t.name+(t.put.join?" "+t.put.join(" "):"")+" "};return e.prototype={constructor:e,_onTapStart:function(e){var t=this,o=this.el,i=this.options,a=e.type,s=e.touches&&e.touches[0],r=(s||e).target,l=r,d=i.filter;if(!("mousedown"===a&&0!==e.button||i.disabled)&&(r=n(r,i.draggable,o))){if(C=p(r),"function"==typeof d){if(d.call(this,e,r,this))return c(t,l,"filter",r,o,C),void e.preventDefault()}else if(d&&(d=d.split(",").some(function(e){return e=n(l,e.trim(),o),e?(c(t,e,"filter",r,o,C),!0):void 0})))return void e.preventDefault();(!i.handle||n(l,i.handle,o))&&this._prepareDragStart(e,s,r)}},_prepareDragStart:function(e,t,n){var o,a=this,r=a.el,c=a.options,d=r.ownerDocument;n&&!v&&n.parentNode===r&&(E=e,k=r,v=n,w=v.parentNode,y=v.nextSibling,I=c.group,o=function(){a._disableDelayedDrag(),v.draggable=!0,s(v,a.options.chosenClass,!0),a._triggerDragStart(t)},c.ignore.split(",").forEach(function(e){l(v,e.trim(),u)}),i(d,"mouseup",a._onDrop),i(d,"touchend",a._onDrop),i(d,"touchcancel",a._onDrop),c.delay?(i(d,"mouseup",a._disableDelayedDrag),i(d,"touchend",a._disableDelayedDrag),i(d,"touchcancel",a._disableDelayedDrag),i(d,"mousemove",a._disableDelayedDrag),i(d,"touchmove",a._disableDelayedDrag),a._dragStartTimer=setTimeout(o,c.delay)):o())},_disableDelayedDrag:function(){var e=this.el.ownerDocument;clearTimeout(this._dragStartTimer),a(e,"mouseup",this._disableDelayedDrag),a(e,"touchend",this._disableDelayedDrag),a(e,"touchcancel",this._disableDelayedDrag),a(e,"mousemove",this._disableDelayedDrag),a(e,"touchmove",this._disableDelayedDrag)},_triggerDragStart:function(e){e?(E={target:v,clientX:e.clientX,clientY:e.clientY},this._onDragStart(E,"touch")):this.nativeDraggable?(i(v,"dragend",this),i(k,"dragstart",this._onDragStart)):this._onDragStart(E,!0);try{R.selection?R.selection.empty():window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function(){k&&v&&(s(v,this.options.ghostClass,!0),e.active=this,c(this,k,"start",v,k,C))},_emulateDragOver:function(){if(N){if(this._lastX===N.clientX&&this._lastY===N.clientY)return;this._lastX=N.clientX,this._lastY=N.clientY,X||r(b,"display","none");var e=R.elementFromPoint(N.clientX,N.clientY),t=e,n=" "+this.options.group.name,o=q.length;if(t)do{if(t[B]&&t[B].options.groups.indexOf(n)>-1){for(;o--;)q[o]({clientX:N.clientX,clientY:N.clientY,target:e,rootEl:t});break}e=t}while(t=t.parentNode);X||r(b,"display","")}},_onTouchMove:function(t){if(E){e.active||this._dragStarted(),this._appendGhost();var n=t.touches?t.touches[0]:t,o=n.clientX-E.clientX,i=n.clientY-E.clientY,a=t.touches?"translate3d("+o+"px,"+i+"px,0)":"translate("+o+"px,"+i+"px)";O=!0,N=n,r(b,"webkitTransform",a),r(b,"mozTransform",a),r(b,"msTransform",a),r(b,"transform",a),t.preventDefault()}},_appendGhost:function(){if(!b){var e,t=v.getBoundingClientRect(),n=r(v);b=v.cloneNode(!0),s(b,this.options.ghostClass,!1),s(b,this.options.fallbackClass,!0),r(b,"top",t.top-U(n.marginTop,10)),r(b,"left",t.left-U(n.marginLeft,10)),r(b,"width",t.width),r(b,"height",t.height),r(b,"opacity","0.8"),r(b,"position","fixed"),r(b,"zIndex","100000"),r(b,"pointerEvents","none"),this.options.fallbackOnBody&&R.body.appendChild(b)||k.appendChild(b),e=b.getBoundingClientRect(),r(b,"width",2*t.width-e.width),r(b,"height",2*t.height-e.height)}},_onDragStart:function(e,t){var n=e.dataTransfer,o=this.options;this._offUpEvents(),"clone"==I.pull&&($=v.cloneNode(!0),r($,"display","none"),k.insertBefore($,v)),t?("touch"===t?(i(R,"touchmove",this._onTouchMove),i(R,"touchend",this._onDrop),i(R,"touchcancel",this._onDrop)):(i(R,"mousemove",this._onTouchMove),i(R,"mouseup",this._onDrop)),this._loopId=setInterval(this._emulateDragOver,50)):(n&&(n.effectAllowed="move",o.setData&&o.setData.call(this,n,v)),i(R,"drop",this),setTimeout(this._dragStarted,0))},_onDragOver:function(e){var o,i,a,s=this.el,l=this.options,c=l.group,u=c.put,g=I===c,p=l.sort;if(void 0!==e.preventDefault&&(e.preventDefault(),!l.dragoverBubble&&e.stopPropagation()),O=!0,I&&!l.disabled&&(g?p||(a=!k.contains(v)):I.pull&&u&&(I.name===c.name||u.indexOf&&~u.indexOf(I.name)))&&(void 0===e.rootEl||e.rootEl===this.el)){if(F(e,l,this.el),Y)return;if(o=n(e.target,l.draggable,s),i=v.getBoundingClientRect(),a)return t(!0),void($||y?k.insertBefore(v,$||y):p||k.appendChild(v));if(0===s.children.length||s.children[0]===b||s===e.target&&(o=h(s,e))){if(o){if(o.animated)return;m=o.getBoundingClientRect()}t(g),d(k,s,v,i,o,m)!==!1&&(v.contains(s)||(s.appendChild(v),w=s),this._animate(i,v),o&&this._animate(m,o))}else if(o&&!o.animated&&o!==v&&void 0!==o.parentNode[B]){S!==o&&(S=o,x=r(o),P=r(o.parentNode));var _,m=o.getBoundingClientRect(),D=m.right-m.left,T=m.bottom-m.top,C=/left|right|inline/.test(x.cssFloat+x.display)||"flex"==P.display&&0===P["flex-direction"].indexOf("row"),A=o.offsetWidth>v.offsetWidth,E=o.offsetHeight>v.offsetHeight,N=(C?(e.clientX-m.left)/D:(e.clientY-m.top)/T)>.5,j=o.nextElementSibling,H=d(k,s,v,i,o,m);if(H!==!1){if(Y=!0,setTimeout(f,30),t(g),1===H||-1===H)_=1===H;else if(C){var L=v.offsetTop,R=o.offsetTop;_=L===R?o.previousElementSibling===v&&!A||N&&A:R>L}else _=j!==v&&!E||N&&E;v.contains(s)||(_&&!j?s.appendChild(v):o.parentNode.insertBefore(v,_?j:o)),w=v.parentNode,this._animate(i,v),this._animate(m,o)}}}},_animate:function(e,t){var n=this.options.animation;if(n){var o=t.getBoundingClientRect();r(t,"transition","none"),r(t,"transform","translate3d("+(e.left-o.left)+"px,"+(e.top-o.top)+"px,0)"),t.offsetWidth,r(t,"transition","all "+n+"ms"),r(t,"transform","translate3d(0,0,0)"),clearTimeout(t.animated),t.animated=setTimeout(function(){r(t,"transition",""),r(t,"transform",""),t.animated=!1},n)}},_offUpEvents:function(){var e=this.el.ownerDocument;a(R,"touchmove",this._onTouchMove),a(e,"mouseup",this._onDrop),a(e,"touchend",this._onDrop),a(e,"touchcancel",this._onDrop)},_onDrop:function(t){var n=this.el,o=this.options;clearInterval(this._loopId),clearInterval(j.pid),clearTimeout(this._dragStartTimer),a(R,"mousemove",this._onTouchMove),this.nativeDraggable&&(a(R,"drop",this),a(n,"dragstart",this._onDragStart)),this._offUpEvents(),t&&(O&&(t.preventDefault(),!o.dropBubble&&t.stopPropagation()),b&&b.parentNode.removeChild(b),v&&(this.nativeDraggable&&a(v,"dragend",this),u(v),s(v,this.options.ghostClass,!1),s(v,this.options.chosenClass,!1),k!==w?(A=p(v),A>=0&&(c(null,w,"sort",v,k,C,A),c(this,k,"sort",v,k,C,A),c(null,w,"add",v,k,C,A),c(this,k,"remove",v,k,C,A))):($&&$.parentNode.removeChild($),
v.nextSibling!==y&&(A=p(v),A>=0&&(c(this,k,"update",v,k,C,A),c(this,k,"sort",v,k,C,A)))),e.active&&((null===A||-1===A)&&(A=C),c(this,k,"end",v,k,C,A),this.save())),k=v=w=b=y=$=D=T=E=N=O=A=S=x=I=e.active=null)},handleEvent:function(e){var t=e.type;"dragover"===t||"dragenter"===t?v&&(this._onDragOver(e),o(e)):("drop"===t||"dragend"===t)&&this._onDrop(e)},toArray:function(){for(var e,t=[],o=this.el.children,i=0,a=o.length,s=this.options;a>i;i++)e=o[i],n(e,s.draggable,this.el)&&t.push(e.getAttribute(s.dataIdAttr)||g(e));return t},sort:function(e){var t={},o=this.el;this.toArray().forEach(function(e,i){var a=o.children[i];n(a,this.options.draggable,o)&&(t[e]=a)},this),e.forEach(function(e){t[e]&&(o.removeChild(t[e]),o.appendChild(t[e]))})},save:function(){var e=this.options.store;e&&e.set(this)},closest:function(e,t){return n(e,t||this.options.draggable,this.el)},option:function(e,t){var n=this.options;return void 0===t?n[e]:(n[e]=t,void("group"===e&&W(n)))},destroy:function(){var e=this.el;e[B]=null,a(e,"mousedown",this._onTapStart),a(e,"touchstart",this._onTapStart),this.nativeDraggable&&(a(e,"dragover",this),a(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),q.splice(q.indexOf(this._onDragOver),1),this._onDrop(),this.el=e=null}},e.utils={on:i,off:a,css:r,find:l,is:function(e,t){return!!n(e,t,e)},extend:m,throttle:_,closest:n,toggleClass:s,index:p},e.create=function(t,n){return new e(t,n)},e.version="1.3.0",e});